--====================================================================== 
--[[ 
* ReaScript Name: kawa_GUI_TestTabComponent. 
* Version: 2016/06/15 
* Author: kawa_ 
* Author URI: http://forum.cockos.com/member.php?u=105939 
* Repository: GitHub 
* Repository URI: https://github.com/kawaCat/ReaScript-MidiPack 
--]] 
--====================================================================== 
bit32={band=function(a,b)return a&b;end,bor=function(a,b)return a|b;end,bxor=function(a,b)return a~b;end,bnot=function(a)return~a;end,rshift=function(a,n)return a>>n;end,lshift=function(a,n)return a<<n;end,};
if(_DBG_==true)then else function DBG()end end math.randomseed(reaper.time_precise()*os.time()/1e3)function HSVToRGB(r,c,u)local i,n,o,h,l,e,t,s,a local d=r local r=c if(d>360)then d=d-360;elseif(d<0)then d=d+360;end if(r>1)then r=1;elseif(r<0)then r=0;end e=math.floor(255*u)if(e>255)then e=255;elseif(e<0)then e=0;end if(r==0)then i=e;n=e;o=e;else h=math.floor(d/60)l=d/60-h t=math.floor(e*(1-r))if(t<0)then t=0;elseif(t>255)then t=255;end s=math.floor(e*(1-l*r))if(s<0)then s=0;elseif(s>255)then s=255;end a=math.floor(e*(1-(1-l)*r))if(a<0)then a=0;elseif(a>255)then a=255;end if(h==0)then i=e;n=a;o=t;elseif(h==1)then i=s;n=e;o=t;elseif(h==2)then i=t;n=e;o=a;elseif(h==3)then i=t;n=s;o=e;elseif(h==4)then i=a;n=t;o=e;elseif(h==5)then i=e;n=t;o=s;else i=e;n=a;o=t;end end return i,n,o end function RGBToHSV(i,o,a)i,o,a=i/255,o/255,a/255;local t,s=math.max(i,o,a),math.min(i,o,a)local e,r,h=0,0,0 h=(t+s)/2 if(t==s)then e,r=0,0 else local n=t-s local r=0 if(h>.5)then r=n/(2-t-s);else r=n/(t+s);end if(t==i)then e=(o-a)/n if(o<a)then e=e+6;end elseif(t==o)then e=(a-i)/n+2 elseif(t==a)then e=(i-o)/n+4 end e=e/6 end return e*360,r,h end function rotPoint(t,a,o,i,e)local o=o-t local i=i-a local n=o*math.cos(e)-i*math.sin(e)local o=o*math.sin(e)+i*math.cos(e)local e=t+n local t=a+o return e,t end function deepcopy(t)local a=type(t)local e if a=='table'then e={}for a,t in next,t,nil do e[deepcopy(a)]=deepcopy(t)end setmetatable(e,deepcopy(getmetatable(t)))else e=t end return e end function table.toString(a)local function l(e)return string.format("%q",e)end local d="";local function e(e)d=d..e end;local r,t="   ","\n"local h,a={a},{[a]=1}e("return {"..t)for o,n in ipairs(h)do e("-- Table: {"..o.."}"..t)e("{"..t)local s={}for i,o in ipairs(n)do s[i]=true local i=type(o)if i=="table"then if not a[o]then table.insert(h,o)a[o]=#h end e(r.."{"..a[o].."},"..t)elseif i=="string"then e(r..l(o)..","..t)elseif i=="number"then e(r..tostring(o)..","..t)end end for n,i in pairs(n)do if(not s[n])then local s=""local o=type(n)if o=="table"then if not a[n]then table.insert(h,n)a[n]=#h end s=r.."[{"..a[n].."}]="elseif o=="string"then s=r.."["..l(n).."]="elseif o=="number"then s=r.."["..tostring(n).."]="end if(s~="")then o=type(i)end if o=="table"then if not a[i]then table.insert(h,i)a[i]=#h end e(s.."{"..a[i].."},"..t)elseif o=="string"then e(s..l(i)..","..t)elseif o=="number"then e(s..tostring(i)..","..t)elseif o=="boolean"then e(s..tostring(i)..","..t)end end end e("},"..t)end e("}")return d;end function table.fromString(e)local e=load(e);local e=e()if(type(e)~="table")then local e={}return e end for t=1,#e do local i={}for a,o in pairs(e[t])do if type(o)=="table"then e[t][a]=e[o[1]]end if type(a)=="table"and e[a[1]]then table.insert(i,{a,e[a[1]]})end end for o,a in ipairs(i)do e[t][a[2]],e[t][a[1]]=e[t][a[1]],nil end end return e[1]end function createDummyTimer()local e={}e._intervalTime=1;e._lastTime=os.clock();e._callBackFuncTable={};e._diffTime=0;e._isRunning=false;function e:startTimer()self._isRunning=true;self._lastTime=os.clock()-self:getDiffTime();end function e:resetTimer()self._lastTime=os.clock();self:_updateDiffTime();self._isRunning=false;end function e:toggleTimer()if(self._isRunning==true)then self:stopTimer();else self:startTimer();end end function e:stopTimer()self._isRunning=false;end function e:isRunning()return self._isRunning;end function e:update()self:updateAndCheck();end function e:updateAndCheck()if(self:isRunning()==true)then self:_updateDiffTime();if(self:getDiffTime()>=self._intervalTime)then self._lastTime=os.clock();self:_updateDiffTime();self:_timerCallBack();end end end function e:setTimerTime(e)self._intervalTime=e;end function e:getTimerTime()return self._intervalTime;end function e:getIntervalTime()return self:getTimerTime();end function e:addTimerCallBackFunction(t)local e=false;for o,a in ipairs(self._callBackFuncTable)do if(a==t)then e=true;break;end end if(e==false)then table.insert(self._callBackFuncTable,t)end end function e:getDiffTime()return self._diffTime;end function e:getDiffTimeV()return(self:getDiffTime()/self._intervalTime);end function e:timerCallBack()end function e:_timerCallBack()self:timerCallBack();for t,e in ipairs(self._callBackFuncTable)do if(type(e)=="function")then e();end end end function e:_updateDiffTime()local e=os.clock();self._diffTime=(e-self._lastTime);end return e;end function createParticalSingle()local e={};e._fadeInFrame_F=.1;e._fadeOutFrame_F=.1;e.lifeFrameNum=60;e.currentLifeFrame=0;e._lifeCounter=createCounter(e.lifeFrameNum);e.ox=0;e.oy=0;e.fx=1;e.fy=1;e._x=e.ox;e._y=e.oy;e._alpha=.5;e.oRotAngle=0;e.fRotAngle=0;e.radius=3;function e:setAlpha(e)self._alpha=e;return self;end function e:setStartPoint(t,e)self._x=t;self._y=e;return self;end function e:setOrigin(e,t)self.ox=e;self.oy=t;return self;end function e:setForce(t,e)self.fx=t;self.fy=e;return self;end function e:setRotAngleFromOrigin(e)self.oRotAngle=e;return self;end function e:setRotAngle(e)self.fRotAngle=e;return self;end function e:setLifeFrameNum(e)self._lifeCounter={}self._lifeCounter=createCounter(e);self.lifeFrameNum=e;return self;end function e:setRadius(e)self.radius=e;return self;end function e:getAlpha()return self._alpha;end;function e:getOrigin()return self.ox,self.oy;end;function e:getForce()return self.fx,self.fy;end;function e:getRotAngleFromOrigin()return self.oRotAngle;end;function e:getRotAngle()return self.fRotAngle;end;function e:getLifeFrame()return self.lifeFrameNum;end;function e:getCurrentLifeFrame()local e=self._lifeCounter:getValueWithOutStep();self.currentLifeFrame=(e*self:getLifeFrame());return self.currentLifeFrame;end function e:getRadius()return self.radius;end;function e:isFinished()local e=(self:getCurrentLifeFrame()>=self:getLifeFrame());return e;end function e:updateAndDraw()self:_update();self:_draw();end function e:_init()end function e:_update()self.currentLifeFrame=self._lifeCounter:getValue()local e=self:_getFadeInOutTimeValue();self._x=self._x+self.fx*e;self._y=self._y+self.fy*e;local e,t=rotPoint(self.ox,self.oy,self._x,self._y,self.oRotAngle*e);self._x=e;self._y=t;end function e:_draw()gfx.set(1,1,1,self._alpha*self:_getFadeInOutTimeValue(),1);local e=self.radius*self:_getFadeInOutTimeValue();gfx.circle(self._x-e/2,self._y-e/2,e,true,false);end function e:_getFadeInOutTimeValue()local a=self._lifeCounter:getValueWithOutStep();local t=1;if(a<self._fadeInFrame_F)then t=a/self._fadeInFrame_F elseif(a<(1-self._fadeOutFrame_F))then t=1;else local e=(a-(1-self._fadeOutFrame_F));t=1-(e/self._fadeOutFrame_F);if(t<.001)then t=0;end end return t;end e:_init();return e;end function createParticleManager()local e={};e._particals={};e._maxPartiCalNum=300;e._lastAddTime=os.clock();e._safeAddIntervalTime=.02;e._targetRadius=8;function e:setTargetRadiusSize(e)self._targetRadius=math.max(math.min(e,100),2);end function e:getTargetRadiusSize()return self._targetRadius;end;function e:getActiveParticalNum()return#self._particals;end;function e:setOriginePoint_A(a,t)for o,e in ipairs(self._particals)do e:setOrigin(a,t);end end function e:setMaxParticalNum(e)self._maxPartiCalNum=e;end function e:addParticleType1(n,i,o,e,t,s)if(os.clock()-self._lastAddTime<self._safeAddIntervalTime)then return end local e=e or 9.75 local a=e/2 local t=t or 30;local r=t/2;local h=self._targetRadius;local o=o or 5;local s=s or 60;for o=1,o do local o=createParticalSingle();o:setStartPoint(n,i):setOrigin(n,i):setAlpha(.3*math.random()+.5):setForce(math.random()*e-a,math.random()*e-a):setRotAngleFromOrigin(math.rad(math.random()*t-r)):setLifeFrameNum(s*math.random()+30):setRadius(h*math.random());table.insert(self._particals,o)end self:_checkMaxParticalNum();self._lastAddTime=os.clock();end function e:updateAndDraw()for t,e in ipairs(self._particals)do e:updateAndDraw();end self:_checkPrticleLife();end function e:_checkPrticleLife()for t,e in ipairs(self._particals)do if(e:isFinished()==true or(e:_getFadeInOutTimeValue()<=0 and e:getCurrentLifeFrame()>0))then table.remove(self._particals,t);break;end end end function e:_checkMaxParticalNum()while(#self._particals>self._maxPartiCalNum)do table.remove(self._particals,1);end end return e;end function createApp(o,a,t)local e={}e._lastTime=os.clock();e._lastMouseCap=nil e._lastMouseX=0 e._lastMouseY=0 e._lastMouseWheel=0 e.mouseWheelDt=0;e._childComponent={}e._lastMouseLeftDown=false e._lastMouseRightDown=false e.width=a or 380;e.height=t or 500;e.title=o or"app"e._CLASS_TYPE="App"function e:addChildComponent(e)local t=false;for o,a in ipairs(self._childComponent)do if(a==e)then t=true;break;end end if(t==false)then e:setBounds(0,0,self.width,self.height)table.insert(self._childComponent,e)end end function e:resized()self.width=gfx.w self.height=gfx.h for t,e in ipairs(self._childComponent)do e:setBounds(0,0,self.width,self.height)end end function e:onMouseMove(a,t)for o,e in ipairs(self._childComponent)do if(e._MouseMove~=nil)then e:_MouseMove(a,t)end end end function e:onMousePress(t)for a,e in ipairs(self._childComponent)do if(e._MousePress~=nil)then e:_MousePress(t)end end end function e:onMouseRelease(t)for a,e in ipairs(self._childComponent)do if(e._MouseRelease~=nil)then e:_MouseRelease(t)end end end function e:onMouseWheel(t)for a,e in ipairs(self._childComponent)do if(e._MouseWheel~=nil)then e:_MouseWheel(t)end end end function e:onDraw(t)for a,e in ipairs(self._childComponent)do if(e._Draw~=nil)then e:_Draw(t)end end end function e:runLoop()local e=os.clock()-self._lastTime;gfx.update();if(self.width~=gfx.w or self.height~=gfx.h)then self:resized();end if(self._lastMouseX~=gfx.mouse_x or self._lastMouseY~=gfx.mouse_y)then self:onMouseMove(self._lastMouseX,self._lastMouseY)end gfx.set(1,1,1,1)self:onDraw(e);if(self._lastMouseCap~=gfx.mouse_cap)then if(self._lastMouseCap<gfx.mouse_cap and(bit32.band(gfx.mouse_cap,1)==1 or bit32.band(gfx.mouse_cap,2)==2 or bit32.band(gfx.mouse_cap,64)==64))then self:onMousePress(gfx.mouse_cap)else self:onMouseRelease(gfx.mouse_cap)end end if(self._lastMouseWheel~=gfx.mouse_wheel)then if(self._lastMouseWheel<gfx.mouse_wheel)then self.mouseWheelDt=1 else self.mouseWheelDt=-1 end self:onMouseWheel(self.mouseWheelDt)else self.mouseWheelDt=0;gfx.mouse_wheel=0;end if(gfx.getchar()>=0)then reaper.defer(function()self:runLoop()end)end self:_storeGfxInfo();end function e:toggleDock()if(gfx.dock(-1)==1)then gfx.dock(0)else gfx.dock(1)end end function e:isDock()local e=false if(gfx.dock(-1)==1)then e=true;end return e;end function e:changeWindowSize(e,t)self.width=e self.height=t gfx.quit()self:_init()self:resized()end function e:_init()local e={}e.settings={}e.settings.font_size=20 e.settings.docker_id=0 gfx.init(self.title,self.width,self.height,e.settings.docker_id)gfx.setfont(1,"Arial",e.settings.font_size)gfx.clear=3355443 self:_storeGfxInfo()end function e:_storeGfxInfo()self._lastMouseX=gfx.mouse_x;self._lastMouseY=gfx.mouse_y;self._lastMouseWheel=gfx.mouse_wheel;self._lastTime=os.clock();self._lastMouseLeftDown=(bit32.band(gfx.mouse_cap,1)==1)self._lastMouseRightDown=(bit32.band(gfx.mouse_cap,2)==2)self._lastMouseCap=gfx.mouse_cap self.width=gfx.w;self.height=gfx.h;end e:_init()return e;end function createRectangle(t,o,a,i)local e={}e.x=t or 0 e.y=o or 0 e.w=a or 100 e.h=i or 100 e._xyTable={}e._cpoint={};e._CLASS_TYPE="Rectangle"function e:getX()return self.x;end function e:getY()return self.y;end function e:getX2()return self.x+self.w;end function e:getY2()return self.y+self.h;end function e:getWidth()return self.w;end function e:getHeight()return self.h;end function e:getCenterPoint()return self._cpoint;end function e:getRectangle()return createRectangle(self.x,self.y,self.w,self.h)end function e:setX(e)self.x=e;self:_updateXyTable();end function e:setY(e)self.y=e;self:_updateXyTable();end function e:setWidth(e)self.w=e;self:_updateXyTable();end function e:setHeight(e)self.h=e;self:_updateXyTable();end function e:setBounds(e,t,o,a)self.x=e;self.y=t;self.w=o;self.h=a;self:_updateXyTable();end function e:setBoundsFromRect(e)self.x=e.x;self.y=e.y;self.w=e.w;self.h=e.h;self:_updateXyTable();end function e:isContact(n,i)local t=0 local e=self._xyTable;for a=1,#e,1 do local o=a+1 if(a+1>#e)then o=1 end local s=e[o].x-e[a].x;local o=e[o].y-e[a].y;local n=n-e[a].x;local e=i-e[a].y;if(s*e-n*o<0)then t=t+1 else t=t-1 end end if(t<=-#e or t>=#e)then return true end return false end function e:isColisionMouse()return self:isContact(gfx.mouse_x,gfx.mouse_y);end function e:reduce(e,t)self.x=(self.x+e);self.y=(self.y+t);self.w=(self.w-e*2);self.h=(self.h-t*2);self:_updateXyTable();end function e:reduce_2(e,o,t,a)self.x=(self.x+e);self.y=(self.y+t);self.w=(self.w-e-o);self.h=(self.h-t-a);self:_updateXyTable();end function e:expand(t,e)self.x=self.x-t;self.y=self.y-e;self.w=self.w+t*2;self.h=self.h+e*2;self:_updateXyTable();end function e:resized()end function e:_updateXyTable()self._xyTable={}self._xyTable[1]={x=self.x,y=self.y}self._xyTable[2]={x=self.x+self.w,y=self.y}self._xyTable[3]={x=self.x+self.w,y=self.y+self.h}self._xyTable[4]={x=self.x,y=self.y+self.h}self._cpoint={x=self.x+self.w/2,y=self.y+self.h/2};self:resized();end function e:removeFromTop(e)self.y=self.y+e;self.h=self.h-e;self:_updateXyTable();end function e:drawFill()gfx.rect(self.x,self.y,self.w,self.h)end e:_updateXyTable();return e;end function createComponent(t,a,i,e,o)local e=createRectangle(a,i,e,o)e.name=t or""e._childComponentTable={}e._parentComponent=nil e._isMousePressing=false e._fontName="Courier New bold"e._fontSize=20 e.isMouseLeftDown=false e.isMouseRightDown=false e.isMouseMiddleDown=false e.isStartInMouseDown=false e.isControlKeyDown=false e.isShiftKeyDown=false e.isAltKeyDown=false e._componentAlpha=1 e._colors={}e._colors["white"]={1,1,1,1}e._colors["black"]={0,0,0,1}e._colors["blue"]={0,0,1,1}e._colors["red"]={1,0,0,1}e._colors["green"]={0,1,0,1}e._CLASS_TYPE="Component"function e:setComponentAlpha(e)self._componentAlpha=e for a,t in ipairs(self._childComponentTable)do t:setComponentAlpha(e)end end function e:setColor(t,e)self._colors[t]=e;end function e:getColor(e)if(self._colors[e]==nil)then return 1,1,1,1*self._componentAlpha end local t=self._colors[e][1]or 1 local a=self._colors[e][2]or 1 local o=self._colors[e][3]or 1 local e=self._colors[e][4]or 1 e=e*self._componentAlpha return t,a,o,e end function e:getColorAsTable(e)local o,e,a,t=self:getColor(e)return{o,e,a,t}end function e:setFont(e,t)if(e~=""and e~=nil)then self._fontName=e end self._fontSize=t end function e:getName()return self.name;end function e:setName(e)self.name=e;end function e:getParrent()return self._parentComponent;end function e:addChildComponent(e)if(e==nil)then return end local t=false;for o,a in ipairs(self._childComponentTable)do if(a==e)then t=true;break;end end if(t==false)then e._parentComponent=self;table.insert(self._childComponentTable,e)else DBG("cant add component."..e.name.."// check same component.")end end function e:removeChildComponent(e)if(e==nil)then return end for a,t in ipairs(self._childComponentTable)do if(t==e)then t._parentComponent=nil;table.remove(self._childComponentTable,a)break;end end end function e:getFitFontSize(e)local e=e or self.name;local e=#e+1 local e=self.w/e*1.8 local e=math.max(math.min(e,self.h),20);return e;end function e:resized()self:onResized()for t,e in ipairs(self._childComponentTable)do e:resized()end end function e:_MouseMove(e,t)self:onMouseMove(e,t)for o,a in ipairs(self._childComponentTable)do a:_MouseMove(e,t)end end function e:_MousePress(t)if(self:isColisionMouse())then self._isMousePressing=true;self.isMouseLeftDown=(bit32.band(gfx.mouse_cap,1)==1)self.isMouseRightDown=(bit32.band(gfx.mouse_cap,2)==2)self.isMouseMiddleDown=(bit32.band(gfx.mouse_cap,64)==64)self.isStartInMouseDown=true self.isControlKeyDown=(bit32.band(gfx.mouse_cap,4)==4)self.isShiftKeyDown=(bit32.band(gfx.mouse_cap,8)==8)self.isAltKeyDown=(bit32.band(gfx.mouse_cap,16)==16)end self:onMousePress(t)for a,e in ipairs(self._childComponentTable)do if(e:isColisionMouse())then e._isMousePressing=true end e:_MousePress(t)end end function e:_MouseRelease(e)if(self._isMousePressing==true and(bit32.band(gfx.mouse_cap,1)~=1)and(bit32.band(gfx.mouse_cap,2)~=1))then self._isMousePressing=false;end self:onMouseRelease(e)for a,t in ipairs(self._childComponentTable)do t:_MouseRelease(e)end self.isMouseLeftDown=(bit32.band(gfx.mouse_cap,1)==1)self.isMouseRightDown=(bit32.band(gfx.mouse_cap,2)==2)self.isMouseMiddleDown=(bit32.band(gfx.mouse_cap,64)==64)self.isStartInMouseDown=false self.isControlKeyDown=(bit32.band(gfx.mouse_cap,4)==4)self.isShiftKeyDown=(bit32.band(gfx.mouse_cap,8)==8)self.isAltKeyDown=(bit32.band(gfx.mouse_cap,16)==16)end function e:_MouseWheel(e)self:onMouseWheel(e)for a,t in ipairs(self._childComponentTable)do t:_MouseWheel(e)end end function e:_Draw(t)gfx.set(1,1,1,1*self._componentAlpha)gfx.setfont(1,self._fontName,self._fontSize)self:onDraw(t)for a,e in ipairs(self._childComponentTable)do gfx.set(1,1,1,1*self._componentAlpha)gfx.setfont(1,e._fontName,e._fontSize)e:_Draw(t)end gfx.setfont(1,self._fontName,self._fontSize)self:onDraw2(t)end function e:_isMouseDragging()return self._isMousePressing;end function e:onMouseMove(e,e)end function e:onMousePress(e)end function e:onMouseRelease(e)end function e:onMouseWheel(e)end function e:onDraw(e)end function e:onDraw2(e)end function e:onResized()end return e;end function createButton(o,i,a,e,t)local e=createComponent(o,i,a,e,t)e._mouseClickFuncTable={}e._mouseWheelFuncTable={}e._isAutoFontSizeMode=false;e:setColor("text",{0,0,0,1})e:setColor("background",{1,1,1,1})e:setColor("background_onMouse",{0,1,1,1})e._CLASS_TYPE="Button"function e:isAutoFontSizeMode()return self._isAutoFontSizeMode;end function e:setAutoFontSizeMode(e)self._isAutoFontSizeMode=e;end function e:addMouseReleaseFunction(e)if(type(e)~="function")then return end local t=false for o,a in ipairs(self._mouseClickFuncTable)do if(a==e)then t=true end end if(t==false)then table.insert(self._mouseClickFuncTable,e)end end function e:addMouseWheelFunction(e)if(type(e)~="function")then return end local t=false for o,a in ipairs(self._mouseWheelFuncTable)do if(a==e)then t=true end end if(t==false)then table.insert(self._mouseWheelFuncTable,e)end end function e:onMouseRelease(t)if(self:isColisionMouse()and self.isStartInMouseDown==true)then for a,e in ipairs(self._mouseClickFuncTable)do if(type(e)=="function")then e(self,t)end end end end function e:onDraw(e)if(self:isColisionMouse())then gfx.set(self:getColor("background_onMouse"))else gfx.set(self:getColor("background"))end gfx.rect(self.x,self.y,self.w,self.h,true)local a=self:getCenterPoint();local t=#self.name local e=self._fontSize;if(self:isAutoFontSizeMode())then local t=self.w/t;e=math.min(t,self._fontSize);end gfx.set(self:getColor("text"))gfx.setfont(1,self._fontName,e)gfx.x=a.x-(gfx.texth/2)*(t/2)gfx.y=a.y-gfx.texth/2 gfx.drawstr(self.name)end function e:onMouseWheel(t)if(self:isColisionMouse())then for a,e in ipairs(self._mouseWheelFuncTable)do if(type(e)=="function")then e(self,t)end end end end return e;end function createCounter(t)local e={}e.m_value=0;e.m_stepValue=0;e.m_frameNum=t or 60 e._CLASS_TYPE="Counter"function e:setCounterFrame(e)self.m_frameNum=e;self:_calcStepValue();end function e:setForward()self:_calcStepValue()end function e:setBackward()self:_calcStepValue()self:inverse();end function e:inverse()self.m_stepValue=self.m_stepValue*-1;end function e:reset()self:_calcStepValue();self.m_value=0;end function e:isActive()if(self.m_value~=0 and self.m_vakue~=1)then return true;end return false;end function e:isStartTime()return(self:getValueWithOutStep()==0)end function e:isFinished()if(self.m_stepValue>0)then return(self.m_value>=1)else return(self.m_value<=0)end end function e:getValue()self:_step()return self:_inOutCubic(self.m_value)end function e:getValueWithOutStep()return self.m_value;end function e:_calcStepValue()self.m_stepValue=1/self.m_frameNum;end function e:_step()if(self.m_value~=1 and self.m_stepValue>0 or self.m_value~=0 and self.m_stepValue<0)then self.m_value=self.m_value+self.m_stepValue;if(self.m_value>=1)then self.m_value=1;end if(self.m_value<=0)then self.m_value=0;end;end;end function e:_inOutCubic(t)t=t*2 if t<1 then return .5*t*t*t else t=t-2 return .5*(t*t*t+2)end end e:_calcStepValue();return e;end function createTabComponent(e)local e=createComponent(e)e._nextComponentKey=""e._currentComponentKey=""e._components={}e._childTabComponents={}e._buttons={}e._keyStringList={}e._currentKeyStringIdx=0;e:setColor("currentTabButton_background",{.5,.5,1,1})e:setColor("tabButton_backGround",{1,1,1,1})e:setColor("tabButton_backGround_onMouse",{0,1,1,1})e._buttonArea=createRectangle();e._buttonMargin={3,3,3,3}e._isFadeMode=false e._animCounter=createCounter(15)e._CLASS_TYPE="TabComponent"function e:setFadeMode(e)self._isFadeMode=e for a,t in pairs(self._childTabComponents)do t._isFadeMode=e end end function e:setButtonMargin(a,t,o,e)self._buttonMargin={a,t,o,e}end function e:getTabCount()local e=0 for t,t in pairs(self._components)do e=e+1 end return e end function e:getCurrentTabComponent()return self._components[self._currentComponentKey]end function e:addTab(t,e)self._components[t]=e self:_addButton(t)self:_addKeyToKeyStringList(t)self:_resizeButtonComp();self:_resizeCompInTabed(e);if(e._CLASS_TYPE=="TabComponent")then local a=false for i,o in ipairs(self._childTabComponents)do e._keyStr=t;if(o==e)then a=true break;end end if(a==false)then table.insert(self._childTabComponents,e)end end end function e:removeTab(e)self._components[e]=nil self:_removeKeyFromKeyStringList(e)self:_removeButton(e)self:_resizeButtonComp()for a,t in ipairs(self._childTabComponents)do if(t._keyStr==e)then table.remove(self._childTabComponents,a);break;end end end function e:changeTab(e)if((self._animCounter:isFinished()==true or self._animCounter:isStartTime()==true)and self._nextComponentKey~=e and self._currentComponentKey==self._nextComponentKey)then self._nextComponentKey=e self._animCounter:reset()self:_resizeCompInTabed(self._components[e]);end end function e:onResized()self:_resizeButtonComp();self:_resizeCompInTabed(self._components[self._nextComponentKey]);self:_resizeCompInTabed(self._components[self._currentComponentKey]);end function e:onDraw2(e)if(self._isFadeMode==true)then self:_checkCurrentTabChangedWithFade()else self:_checkCurrentTabChanged()end end function e:onMouseWheel(e)if(self._buttonArea:isColisionMouse())then local e=self._currentKeyStringIdx+e if(e<=0)then e=#self._keyStringList end;if(e>#self._keyStringList)then e=1 end;local e=self._keyStringList[e]self:changeTab(e)end end function e:_init()end function e:_checkCurrentTabChanged()if(self._currentComponentKey==self._nextComponentKey)then return end local t=self._components[self._currentComponentKey]local e=self._components[self._nextComponentKey]if(e==nil)then return end self:_syncButtonColor()self:removeChildComponent(t)self:addChildComponent(e)self:_resizeCompInTabed(e);self._currentComponentKey=self._nextComponentKey self._currentKeyStringIdx=self:_getIndexFromKeyStringIndex(self._nextComponentKey)end function e:_checkCurrentTabChangedWithFade()local t=self._components[self._currentComponentKey]local e=self._components[self._nextComponentKey]if(e==nil)then return end if(self._currentComponentKey~=self._nextComponentKey and self._animCounter:isStartTime()==true)then self:addChildComponent(e)self:_resizeCompInTabed(e);end if(self._animCounter:isFinished()==true and self._currentComponentKey~=self._nextComponentKey)then self:removeChildComponent(t)self._currentKeyStringIdx=self:_getIndexFromKeyStringIndex(self._nextComponentKey)self._currentComponentKey=self._nextComponentKey return end if(self._animCounter:isFinished()==true)then return end local a=self._animCounter:getValue()if(t~=nil)then t:setComponentAlpha(1-a)e:setComponentAlpha(a)else e:setComponentAlpha(1)end self:_syncButtonColor()end function e:_addButton(e)local t=createButton(e)t:addMouseReleaseFunction(function(t,t)self:changeTab(e)end)self._buttons[e]=t self:addChildComponent(self._buttons[e])end function e:_removeButton(e)self:removeChildComponent(self._buttons[e])self._buttons[e]=nil end function e:_getButtonAreaHeight()return math.min(self.h/10,40);end function e:_resizeCompInTabed(a)if(a~=nil)then local t=self:_getButtonAreaHeight();local e=createRectangle()e.x=self.x e.y=self.y+t e.w=self.w e.h=self.h-t local t=3 local t=3 a:setBoundsFromRect(e)end end function e:_resizeButtonComp()self._buttonArea=self:getRectangle();self._buttonArea:setHeight(self:_getButtonAreaHeight())local i=self._buttonMargin[1]local s=self._buttonMargin[2]local n=self._buttonMargin[3]local a=self._buttonMargin[4]local o=self:getTabCount()local e=createRectangle()e.x=self.x e.y=self.y e.w=self.w/o e.h=self._buttonArea:getHeight()for h,t in ipairs(self._keyStringList)do local t=self._buttons[t]t:setBoundsFromRect(e)if(o==h)then t:reduce_2(i,s,n,a)else t:reduce_2(i,0,n,a)end e.x=e.x+e.w end end function e:_syncButtonColor()local a=self:getColorAsTable("currentTabButton_background")local i=self:getColorAsTable("tabButton_backGround")local o=self:getColorAsTable("tabButton_backGround_onMouse")local e=self._buttons[self._nextComponentKey]if(e~=nil)then local t=self._buttons[self._currentComponentKey]if(t~=nil)then t:setColor("background",i);t:setColor("background_onMouse",o);end e:setColor("background",a);e:setColor("background_onMouse",a);end end function e:_addKeyToKeyStringList(e)local t=false for o,a in ipairs(self._keyStringList)do if(a==e)then t=true break end end if(t==false)then table.insert(self._keyStringList,e);end end function e:_removeKeyFromKeyStringList(t)for e,a in ipairs(self._keyStringList)do if(a==t)then table.remove(self._keyStringList,e)break end end end function e:_getIndexFromKeyStringIndex(o)local e=1 for a,t in ipairs(self._keyStringList)do if(t==o)then e=a break end end return e end return e end function createSlider(t,o,i,a,e)local e=createComponent(t,o,i,a,e)e.value=.5 e._valueChangeFuncTable={}e.label=t..":";e._meterValueRect=createRectangle()e.maxValue=1 e.minValue=0 e:setColor("text",{0,0,0,1})e:setColor("background",{1,1,1,1})e:setColor("background_onMouse",{0,1,1,1})e:setColor("meter_value",{1,.2,.2,1})e._CLASS_TYPE="Slider"e.meterType=1 function e:addOnValueChangeFunction(e)if(type(e)~="function")then return end local t=false for o,a in ipairs(self._valueChangeFuncTable)do if(a==e)then t=true end end if(t==false)then table.insert(self._valueChangeFuncTable,e)end end function e:setMaxMinValue(t,e)self.maxValue=t self.minValue=e end function e:getValue()return self.value;end function e:setValue(e,t)self.value=e local e=t or true if(self.value>self.maxValue)then self.value=self.maxValue end if(self.value<self.minValue)then self.value=self.minValue end if(e==true)then for t,e in ipairs(self._valueChangeFuncTable)do e(self)end end self:_updateMeterValueRect();end function e:setMeterType(e)self.meterType=e end function e:onResized()self:_updateMeterValueRect()end function e:onMouseMove(t,e)if(self:_isMouseDragging())then local e=self:_xyToValue(t,e)self:setValue(e)end end function e:onMouseWheel(o)if(self:isColisionMouse())then local a=self:_xyToValue(gfx.mouse_x,gfx.mouse_y)local e=self:getValue()local t=1 if(a<e)then t=-1 end e=e+(a-e)/40*o*t self:setValue(e)end end function e:onDraw(e)self:_updateMeterValueRect();self:_drawBackGround()if(self:isHorizontaleMeter())then self:_drawHorizontalMeter()elseif(self:isHorizontalCenterMeter())then self:_drawHorizontalCenterMeter()end self:_drawValueText()end function e:valueToText()return string.format("%0.2f",self.value)end function e:setLabel(e)self.label=e;end function e:isHorizontaleMeter()return(bit32.band(self.meterType,1)~=0)end function e:isHorizontalCenterMeter()return(bit32.band(self.meterType,2)~=0)end function e:_updateMeterValueRect()self._meterValueRect=self:getRectangle()self._meterValueRect:reduce(2,2);if(self:isHorizontaleMeter())then self._meterValueRect.w=self._meterValueRect.w*self.value elseif(self:isHorizontalCenterMeter())then local e=19 local t=self._meterValueRect.w*self.value self._meterValueRect.x=t-e/4 self._meterValueRect.w=e if(self._meterValueRect.x<self.x)then self._meterValueRect.x=self.x+2;end if(self._meterValueRect:getX2()>self:getX2()-2)then self._meterValueRect.w=self:getX2()-self._meterValueRect.x-2;end end self._meterValueRect:_updateXyTable();end function e:_drawBackGround()if(self:isColisionMouse())then gfx.set(self:getColor("background_onMouse"))else gfx.set(self:getColor("background"))end gfx.rect(self.x,self.y,self.w,self.h,true)end function e:_drawValueText()gfx.set(self:getColor("text"))local a=self:getCenterPoint();local t=gfx.texth;local e=self.label..self:valueToText()local o=#e gfx.x=a.x-(t/2)*(o/2)gfx.y=a.y-t/2 gfx.drawstr(e)end function e:_drawHorizontalMeter()gfx.set(self:getColor("meter_value"))gfx.setfont(1,self._fontName,self._fontSize)local e=self._meterValueRect gfx.rect(e.x,e.y,e.w,e.h,true)end function e:_drawHorizontalCenterMeter()gfx.set(self:getColor("meter_value"))gfx.setfont(1,self._fontName,self._fontSize)local e=self._meterValueRect gfx.rect(e.x,e.y,e.w,e.h,true)local e=self:getCenterPoint()gfx.set(self:getColor("black"))gfx.line(e.x,self.y,e.x,self:getY2())self:_drawValueText()end function e:_xyToValue(t,e)local e=0 if(self:isHorizontaleMeter())then local t=t-self.x local t=t/self.w e=t*self.maxValue end if(self:isHorizontalCenterMeter())then local t=t-self.x local t=t/self.w e=t*self.maxValue;end return e end return e;end function createTextPanel(e)local e=createComponent(e,x,y,w,h)e.offsetY=0 e.drawTexts={}e:setColor("text",{0,0,0,1})e:setColor("background",{1,1,1,1})e._marginX=10 e._marginY=10 e._CLASS_TYPE="TextPanel"e._AlIGN_CENTOR_=false;function e:setTextMargin(e,t)self._marginX=e self._marginY=t end function e:setDrawTextsAsCopy(e)self.drawTexts=deepcopy(e)end function e:setTextOffsetLine(e)self.offsetY=e;if(self.offsetY<0)then self.offsetY=0;end if(self.offsetY>#self.drawTexts-1)then self.offsetY=#self.drawTexts-1;end end function e:tryTextShown(e)if(self:_checkNeedOffsetOption())then for t,a in ipairs(self.drawTexts)do if(a==e)then self:setTextOffsetLine(t-1)break;end end else self:setTextOffsetLine(0);end end function e:setDrawTexts(e)self.drawTexts=e end function e:setCentorizeText(e)self._AlIGN_CENTOR_=e;end function e:onMouseWheel(e)if(self:isColisionMouse())then if(self:_checkNeedOffsetOption())then self:setTextOffsetLine(self.offsetY-e)else self:setTextOffsetLine(0);end end end function e:onDraw(e)gfx.set(self:getColor("background"))gfx.rect(self.x,self.y,self.w,self.h,true)gfx.setfont(1,self._fontName,self._fontSize)gfx.set(self:getColor("text"))local t=self._marginX local o=self._marginY for e=self.offsetY+1,#self.drawTexts do local a=self.x+t local t=self.y+gfx.texth*(e-self.offsetY-1)+o if(self._AlIGN_CENTOR_==true)then local o=#self.drawTexts[e];local o=gfx.texth/2*o;a=(self.x+self.w/2)-o/2;t=(self.y+self.h/2)-gfx.texth/2;local e=self.drawTexts[e];local e=self:_checkDrawStrSize(e,self);self:setFont("",e);end if(t>self:getY2()-o)then break;end gfx.x=a gfx.y=t gfx.drawstr(self.drawTexts[e])end end function e:_checkNeedOffsetOption()local e=(self.h-self._marginY)/self._fontSize return(e<#self.drawTexts)end function e:_checkDrawStrSize(t,e)local t=#t+1 local t=e.w/t*1.8 local e=math.max(math.min(t,e.h),20);return e;end return e end function createCursolRect(e)local e=createComponent(e,x,y,w,h)e.movingArea=createRectangle(0,0,gfx.w,gfx.h)e:setColor("background",{1,0,0,1})e:setColor("centerCircle_out",{0,0,0,1})e:setColor("centerCircle",{1,1,1,1})e._rectSize=20;e._onMovedFunction={}e._CLASS_TYPE="CursolRect"function e:addOnMovedFunction(e)if(type(e)~="function")then return end local t=false for o,a in ipairs(self._onMovedFunction)do if(a==e)then t=true end end if(t==false)then table.insert(self._onMovedFunction,e)end end function e:setMovingArea(e)self.movingArea=e end function e:setRectSize(e)self._rectSize=e;self:setWidth(self._rectSize)self:setHeight(self._rectSize)end function e:onDraw(e)local e=self:getCenterPoint();local t=self.w/2 gfx.set(self:getColor("centerCircle_out"))gfx.circle(e.x,e.y-1,t,true)t=self.w/2*.7 gfx.set(self:getColor("centerCircle"))gfx.circle(e.x,e.y-1,t,true)end function e:onMouseMove(t,e)if(self:_isMouseDragging())then self:setX(t-self.w/2)self:setY(e-self.h/2)self:_checkMovingArea();for t,e in ipairs(self._onMovedFunction)do e(self)end end end function e:_checkMovingArea()local e=self.movingArea:getX()local t=self.movingArea:getX2()-self._rectSize local a=self.movingArea:getY()local o=self.movingArea:getY2()-self._rectSize if(self.x>t)then self:setX(t);end if(self.x<e)then self:setX(e);end if(self.y>o)then self:setY(o);end if(self.y<a)then self:setY(a);end end return e end function createXYSlider(e)local e=createComponent(e,x,y,w,h)e._editCursolRect=nil e._editCursolSize=18 e._gridDiv=4 e._labelTable={"A","B","C","D"}e._labelFontSize=24;e._lastXValue=.5 e._lastYValue=.5 e:setColor("background",{1,1,1,1})e:setColor("background_grid",{0,0,0,1})e:setColor("background_grid2",{0,0,0,.3})e:setColor("cursolRectColor",{1,0,0,1})e:setColor("text",{0,0,0,1})e._onValueChangedFunction={}e._CLASS_TYPE="XYSlider"function e:addOnValueChangeFunction(e)if(type(e)~="function")then return end local t=false for o,a in ipairs(self._onValueChangedFunction)do if(a==e)then t=true end end if(t==false)then table.insert(self._onValueChangedFunction,e)end end function e:setLabelTable(e)self._labelTable=e;end function e:getXValue()local t=self._editCursolRect:getCenterPoint()local e=self:getRectangle()e:reduce(self._editCursolSize/2,self._editCursolSize/2)local e=(t.x-e.x)/e.w return e end function e:getYValue()local t=self._editCursolRect:getCenterPoint()local e=self:getRectangle()e:reduce(self._editCursolSize/2,self._editCursolSize/2)local e=(t.y-e.y)/e.h return e end function e:setCursolColor(e)self._editCursolRect:setColor("centerCircle",e)end function e:onResized()self:_updateEditoCursolRect()end function e:onDraw(e)self:_drawBackGround()self:_drawBackgroundGrid()self:_drawEditCursolRectBorder()end function e:onDraw2(e)self:_drawValueInfo()self:_drawLabels()self._lastXValue=self:getXValue()self._lastYValue=self:getYValue()end function e:_init()self._editCursolRect=createCursolRect("editCursolRect");self._editCursolRect:setRectSize(self._editCursolSize);self:addChildComponent(self._editCursolRect)self._editCursolRect:addOnMovedFunction(function(e)self:_valueChanged()end)end function e:_updateEditoCursolRect()local e=self:getRectangle()e:reduce(self._editCursolSize/2,self._editCursolSize/2)local t=e.x+(e.w*self._lastXValue)local e=e.y+(e.h*self._lastYValue)t=t-self._editCursolRect.w/2 e=e-self._editCursolRect.h/2 self._editCursolRect:setX(t)self._editCursolRect:setY(e)self._editCursolRect:setMovingArea(self:getRectangle())end function e:_drawBackGround()gfx.set(self:getColor("background"))gfx.rect(self.x,self.y,self.w,self.h)end function e:_drawBackgroundGrid()gfx.set(self:getColor("background_grid"))local e=self:getCenterPoint();gfx.line(self.x,e.y,self:getX2(),e.y)gfx.line(e.x,self.y,e.x,self:getY2())local t=self._gridDiv local o=self.w/t local a=self.h/t gfx.set(self:getColor("background_grid2"))for e=1,t do local t=self.x+o*e local e=self.y+a*e gfx.line(t,self.y,t,self:getY2())gfx.line(self.x,e,self:getX2(),e)end gfx.set(self:getColor("black"))gfx.circle(e.x,e.y-1,2,true)end function e:_drawEditCursolRectBorder()local e=self._editCursolRect:getCenterPoint()gfx.set(self:getColor("background_grid"))gfx.line(self.x,e.y,self:getX2(),e.y)gfx.line(e.x,self.y,e.x,self:getY2())end function e:_drawValueInfo()gfx.set(self:getColor("text"))gfx.setfont(1,self._fontName,self._fontSize)local e=self:getXValue()local t=self:getYValue()local t=string.format("X %1.2f \nY %1.2f",e,t)local e=self:getCenterPoint()gfx.x=e.x+gfx.texth/2 gfx.y=e.y+gfx.texth/2 gfx.drawstr(t)end function e:_drawLabels()gfx.set(self:getColor("text"))gfx.setfont(1,self._fontName,self._labelFontSize)gfx.x=self.x+gfx.texth/2/2 gfx.y=self.y gfx.drawstr(self._labelTable[1])gfx.x=self:getX2()-gfx.texth*.5-gfx.texth*#self._labelTable[2]/2 gfx.y=self.y gfx.drawstr(self._labelTable[2])gfx.x=self:getX2()-gfx.texth*.5-gfx.texth*#self._labelTable[3]/2 gfx.y=self:getY2()-gfx.texth gfx.drawstr(self._labelTable[3])gfx.x=self.x+gfx.texth/2/2 gfx.y=self:getY2()-gfx.texth gfx.drawstr(self._labelTable[4])gfx.setfont(1,self._fontName,self._fontSize)end function e:_valueChanged()for t,e in ipairs(self._onValueChangedFunction)do e(self)end end e:_init();return e;end
_INCLUDE_MODE_=true local o=0 local n=60 local i=1 local u=25 local c=65 local a=-96 local t=(10^(a*.05))function math.valueToDecivel(e)local e=math.log(e,10)*20 if(e<a)then e=a end return e end function math.decivelToValue(e)local e=(10^(e*.05))if(e<t)then e=t end return e end if(package.config:sub(1,1)=="\\")then else end function createPeakMeter(r,h,a,s,e)local e=createComponent(r,h,a,s,e)e._animTime=0;e._track=nil e._trackAccessor=nil e._reaperArray={}e._sumpleBuffer={}e._bufferNum=256;e._lastMaxL=0;e._lastMaxR=0;e._lastRmsL=0;e._lastRmsR=0;function e:onResized()end function e:onDraw(e)self:_drawBackground()self:_drawCircle()self:_drawBuffer();self:_updateBuffer();self:_checkAnimTime(e,3)end function e:_init()end function e:_drawBackground()local e=15;local t=math.ceil(self.w/e)local a=1/e;for a=1,e do local i,o,e=HSVToRGB(o+n*(a/e),1,i)gfx.set(i/255,o/255,e/255,1*self._componentAlpha)gfx.rect(t*(a-1)-1,self.y,t,self.h,true)end end function e:_drawCircle()local e=10 gfx.set(1,1,1,.5*self._componentAlpha);local a=self.w/e local n=3 local s=360/e local i=(self.h/2)-30 local o=(self.h/2)for t=1,e do local a=self.x+a*(t-1);local e=math.rad(360*self._animTime)e=e+math.rad(s*(t-1))local t=self.y+o+((i)*(math.sin(e)))gfx.circle(a,t,n,true,false)e=e-math.rad(180)t=self.y+o+(i*(math.sin(e)))gfx.circle(a,t,n,true,false)end end function e:_checkAnimTime(t,e)self._animTime=self._animTime+(t/e);if(self._animTime>1)then self._animTime=0;end if(self._animTime<0)then self._animTime=0;end end function e:_drawBuffer()gfx.set(0,0,0,1*self._componentAlpha);local n=-72;local h=0;local r=0;local a=0;local o=0;for t,e in ipairs(self._sumpleBuffer)do h=math.max(math.abs(e.l),h)r=math.max(math.abs(e.r),r)a=a+e.l*e.l o=o+e.r*e.r end local s=n local i=n if(a>0)then s=math.sqrt(a/#self._sumpleBuffer)end if(o>0)then i=math.sqrt(o/#self._sumpleBuffer)end if(s<t)then s=t end if(i<t)then i=t end local e=7 self._lastMaxL=self._lastMaxL+(h-self._lastMaxL)/e;self._lastMaxR=self._lastMaxR+(r-self._lastMaxR)/e;self._lastRmsL=self._lastRmsL+(s-self._lastRmsL)/(e+4);self._lastRmsR=self._lastRmsR+(i-self._lastRmsR)/(e+4);local i=math.log(self._lastMaxL,10)*20 local a=math.log(self._lastMaxR,10)*20 if(i<-96)then i=-96;end if(a<-96)then a=-96;end local h=math.log(self._lastRmsL,10)*20 local d=math.log(self._lastRmsR,10)*20 if(h<-96)then h=-96;end if(d<-96)then d=-96;end local s=self.h/2 local function o(e)return self.w-self.w*(e/n);end local e=self.x local t=s local l=self.y local r=o(i)local y=u local w=c local f=1 local u,c,m=HSVToRGB(y-w*(i/n),1,.8+.3*math.abs(self._lastMaxL))gfx.set(u/255,c/255,m/255,f*self._componentAlpha)gfx.rect(e,l,r,t+1,true)e=self.x l=self.y+s r=o(a)u,c,m=HSVToRGB(y-w*(a/n),1,.8+.2*math.abs(self._lastMaxR))gfx.set(u/255,c/255,m/255,f*self._componentAlpha)gfx.rect(e,l,r,t,true)gfx.set(0,0,0,.9*self._componentAlpha)e=o(h)gfx.line(e,self.y,e,self.y+t,false)e=o(d)gfx.line(e,self.y+t,e,self.y+t+t,false)local e=s/2;gfx.setfont(2,"Arial",e,"Bold")gfx.set(0,0,0,1*self._componentAlpha)gfx.x=self.x+10 gfx.y=self.y+gfx.texth/2 gfx.drawstr(string.format("%2.2f",i))gfx.x=self.x+10 gfx.y=self.y+s+gfx.texth/2 gfx.drawstr(string.format("%2.2f",a))gfx.set(0,0,0,1*self._componentAlpha)local function r()local n=20 local s=10 gfx.line(self.x,self.y+self.h/2,self.w,self.y+self.h/2,false)for h=0,10 do local e=self.y;local a=e+n;local t=self.x+o(-10*h)local i=t gfx.line(t,e,i,a,false)e=self.y+self.h;a=self.y+self.h-n;gfx.line(t,e,i,a,false)e=self.y;a=e+s;t=self.x+o(-10*h-5)i=t gfx.line(t,e,i,a,false)e=self.y+self.h;a=self.y+self.h-s;gfx.line(t,e,i,a,false)end end r();end function e:_updateBuffer()self._track=reaper.GetSelectedTrack2(0,0,true)if(self._track==nil)then return end self._trackAccessor=reaper.CreateTrackAudioAccessor(self._track);self._bufferArray=reaper.new_array(self._bufferNum);if(self._track==reaper.GetMasterTrack(0))then self._sumpleBuffer={}self._sumpleBuffer[1]={}self._sumpleBuffer[1].l=reaper.Track_GetPeakInfo(self._track,0)self._sumpleBuffer[1].r=reaper.Track_GetPeakInfo(self._track,1)else local e=reaper.GetAudioAccessorSamples(self._trackAccessor,44100,reaper.GetNumAudioOutputs(),reaper.GetPlayPosition(),self._bufferNum/2,self._bufferArray)if(e~=-1)then self._sumpleBuffer={}local e=1 for t=1,self._bufferNum,2 do self._sumpleBuffer[e]={}self._sumpleBuffer[e].l=self._bufferArray[t];self._sumpleBuffer[e].r=self._bufferArray[t+1];e=e+1 end end end reaper.DestroyAudioAccessor(self._trackAccessor)end function e:_drawPlayTime()local i=math.max(math.min(self.w,self.h)/12,20);gfx.setfont(1,"Arial",i)gfx.set(0,0,0,1*self._componentAlpha)local t=reaper.GetPlayPosition();local a=math.floor(t/60)local o=math.floor(t%60)local t=t-math.floor(t)t=math.floor(t*100)local a=tostring(a)local o=tostring(o)local t=tostring(t)if(#a<2)then a="0"..a;end if(#o<2)then o="0"..o;end if(#t<2)then t="0"..t;end local t=string.format("%s:%s:%s",a,o,t);gfx.y=gfx.h-gfx.texth gfx.x=gfx.w-(#t-1)*i/2 gfx.drawstr(t)end e:_init()return e;end local function a()local e=createApp("test Peak Meter",600,200);local t=createPeakMeter("panel");e:addChildComponent(t);e:runLoop();end if(_INCLUDE_MODE_~=true)then a()end local o=0 local i=60 local n=1 if(package.config:sub(1,1)=="\\")then else end function createOsilloScope(r,a,h,s,e,t)local e=createComponent(a,h,s,e,t)e._animTime=0;e._track=nil e._trackAccessor=nil e._reaperArray={}e._sumpleBuffer={}e._bufferNum=512;e._lastSampleBuffer={};e._isFillWave=true function e:onResized()end function e:onMousePress(e)self:_toggleFillMode()end function e:onDraw(e)self:_drawBackground()self:_drawCircle()self:_drawBuffer();self:_updateBuffer();self:_drawPlayTime();self:_checkAnimTime(e,3)end function e:_init()self:_crearLastSampleBuffer();end function e:_drawBackground()local e=15;local t=math.ceil(self.w/e)local a=1/e;for a=1,e do local i,e,o=HSVToRGB(o+i*(a/e),1,n)gfx.set(i/255,e/255,o/255,1*self._componentAlpha)gfx.rect(t*(a-1)-1,self.y,t,self.h,true)end end function e:_drawCircle()local e=10 gfx.set(1,1,1,.5*self._componentAlpha);local n=self.w/e local a=3 local s=360/e local o=(self.h/2)-30 local i=(self.h/2)for t=1,e do local n=self.x+n*(t-1);local e=math.rad(360*self._animTime)e=e+math.rad(s*(t-1))local t=self.y+i+((o)*(math.sin(e)))gfx.circle(n,t,a,true,false)e=e-math.rad(180)t=self.y+i+(o*(math.sin(e)))gfx.circle(n,t,a,true,false)end end function e:_checkAnimTime(e,t)self._animTime=self._animTime+(e/t);if(self._animTime>1)then self._animTime=0;end if(self._animTime<0)then self._animTime=0;end end function e:_drawBuffer()local e=self._bufferNum local l=self.w/e*2 local e=(self.h/4)local d=e-20;local e=2 gfx.set(0,0,0,1*self._componentAlpha);local s=1.2 local a=(self.h/4)*1 local o=(self.h/4)*3 local h=0 local r=a local i=0 local n=o for e,t in ipairs(self._sumpleBuffer)do self._lastSampleBuffer[e].l=self._lastSampleBuffer[e].l+(t.l-self._lastSampleBuffer[e].l)/s self._lastSampleBuffer[e].r=self._lastSampleBuffer[e].r+(t.r-self._lastSampleBuffer[e].r)/s local t=self._lastSampleBuffer[e].l local s=self._lastSampleBuffer[e].r local e=self.x+l*(e-1)local t=self.y+a-(d*t)gfx.line(h,r,e,t)if(self._isFillWave==true)then gfx.line(e,self.y+a,e,t)end h=e r=t t=self.y+o-(d*s)gfx.line(i,n,e,t)if(self._isFillWave==true)then gfx.line(e,self.y+o,e,t)end i=e n=t end end function e:_updateBuffer()self._track=reaper.GetSelectedTrack2(0,0,true)if(self._track==nil)then return end self._trackAccessor=reaper.CreateTrackAudioAccessor(self._track);self._bufferArray=reaper.new_array(self._bufferNum);local e,t=reaper.GetAudioAccessorSamples(self._trackAccessor,44100,reaper.GetNumAudioOutputs(),reaper.GetPlayPosition(),self._bufferNum/2,self._bufferArray)if(e~=-1)then self._sumpleBuffer={}local e=1 for t=1,self._bufferNum,2 do self._sumpleBuffer[e]={}self._sumpleBuffer[e].l=self._bufferArray[t];self._sumpleBuffer[e].r=self._bufferArray[t+1];e=e+1 end end reaper.DestroyAudioAccessor(self._trackAccessor)end function e:_drawPlayTime()local o=math.max(math.min(self.w,self.h)/12,20);gfx.setfont(1,"Arial",o)gfx.set(0,0,0,1*self._componentAlpha)local e=reaper.GetPlayPosition();local t=math.floor(e/60)local a=math.floor(e%60)local e=e-math.floor(e)e=math.floor(e*100)local t=tostring(t)local a=tostring(a)local e=tostring(e)if(#t<2)then t="0"..t;end if(#a<2)then a="0"..a;end if(#e<2)then e="0"..e;end local e=string.format("%s:%s:%s",t,a,e);gfx.y=gfx.h-gfx.texth gfx.x=gfx.w-(#e-1)*o/2 gfx.drawstr(e)end function e:_crearLastSampleBuffer()self._lastSampleBuffer={}for e=1,self._bufferNum/2,1 do self._lastSampleBuffer[e]={}self._lastSampleBuffer[e].l=0;self._lastSampleBuffer[e].r=0;end end function e:_toggleFillMode()self._isFillWave=(self._isFillWave==false)end e:_init()return e;end local function t()local e=createApp("test OciloScope",600,300);local t=createOsilloScope("panel");e:addChildComponent(t);e:runLoop();end if(_INCLUDE_MODE_~=true)then t()end local n=0 local i=60 local h=1 if(package.config:sub(1,1)=="\\")then else end function createGonioMeter(s,a,o,t,e)local t=createComponent(s,a,o,t,e)t._animTime=0;t._track=nil t._trackAccessor=nil t._reaperArray={}t._sumpleBuffer={}t._bufferNum=512;function t:onResized()end function t:onDraw(e)self:_drawBackground()self:_drawBuffer();self:_updateBuffer();self:_checkAnimTime(e,5)self:_drawPlayTime();end function t:_init()end function t:_drawBackground()local e=15;local t=math.ceil(self.w/e)local a=1/e;for a=1,e do local i,e,o=HSVToRGB(n+i*(a/e),1,h)gfx.set(i/255,e/255,o/255,1*self._componentAlpha)gfx.rect(t*(a-1)-1,self.y,t,self.h,true)end end function t:_checkAnimTime(e,t)self._animTime=self._animTime+(e/t);if(self._animTime>1)then self._animTime=0;end if(self._animTime<0)then self._animTime=0;end end function t:_drawBuffer()local a=math.min(self.w,self.h)/2-10;local t=self:getCenterPoint().x local e=self:getCenterPoint().y local o=1 gfx.x=t gfx.y=e gfx.set(0,0,0,1*self._componentAlpha);for i,o in ipairs(self._sumpleBuffer)do local i=t+o.l*a;local a=e+o.r*a;local e,t=rotPoint(t,e,i,a,math.rad(45));gfx.lineto(e,t)end gfx.lineto(t,e)gfx.set(0,0,0,.5*self._componentAlpha);gfx.setfont(1,"Arial",20)local function h(o)local i,s=rotPoint(t,e,t,e+o,math.rad(45));local n,o=rotPoint(t,e,t,e+o,math.rad(225));local h=t-a local h=e-a local t=t+a local e=e+a gfx.line(i,s,n,o)gfx.line(n,s,i,o)gfx.x=i-gfx.texth/2 gfx.y=o-gfx.texth gfx.drawstr("L")gfx.x=n gfx.y=o-gfx.texth gfx.drawstr("R")end local function o(o)local e,t=rotPoint(t,e,t,e+a,o);gfx.circle(e,t,4,true,true)end h(a);gfx.line(t,self.y,t,self.y+self.h)gfx.line(self.x,e,self.x+self.w,e)gfx.circle(t,e,a,false,false)gfx.set(1,1,1,.9*self._componentAlpha);o(math.rad(self._animTime*360))o(math.rad(self._animTime*360-180))gfx.set(0,0,0,.5*self._componentAlpha);gfx.x=gfx.texth gfx.y=e-gfx.texth gfx.drawstr("side")gfx.x=t+gfx.texth/4 gfx.y=e-a+gfx.texth/6 gfx.drawstr("C")end function t:_updateBuffer()self._track=reaper.GetSelectedTrack2(0,0,true)if(self._track==nil)then return end self._trackAccessor=reaper.CreateTrackAudioAccessor(self._track);self._bufferArray=reaper.new_array(self._bufferNum);local e,t=reaper.GetAudioAccessorSamples(self._trackAccessor,44100,reaper.GetNumAudioOutputs(),reaper.GetPlayPosition(),self._bufferNum/2,self._bufferArray)if(e~=-1)then self._sumpleBuffer={}local e=1 for t=1,self._bufferNum,2 do self._sumpleBuffer[e]={}self._sumpleBuffer[e].l=self._bufferArray[t];self._sumpleBuffer[e].r=self._bufferArray[t+1];e=e+1 end end reaper.DestroyAudioAccessor(self._trackAccessor)end function t:_drawPlayTime()local e=math.max(math.min(self.w,self.h)/12,20);gfx.setfont(1,"Arial",e)gfx.set(0,0,0,1*self._componentAlpha)local e=reaper.GetPlayPosition();local a=math.floor(e/60)local i=math.floor(e%60)local o=e-math.floor(e)o=math.floor(o*100)local e=tostring(a)local a=tostring(i)local o=tostring(o)if(#e<2)then e="0"..e;end if(#a<2)then a="0"..a;end if(#o<2)then o="0"..o;end local e=string.format("%s:%s:%s",e,a,o);gfx.y=gfx.h-gfx.texth gfx.x=gfx.w-(#e-1)*gfx.texth/2-5 gfx.drawstr(e)end t:_init()return t;end local function t()local e=createApp("test Gonio Meter",300,300);local t=createGonioMeter("panel");e:addChildComponent(t);e:runLoop();end if(_INCLUDE_MODE_~=true)then t()end local n=false local e="Courier New bold"local i=3 local s=3 local a=0 if(package.config:sub(1,1)=="\\")then else end local t=-96 local o=(10^(t*.05))function math.valueToDecivel(e)local e=math.log(e,10)*20 if(e<t)then e=t end return e end function math.decivelToValue(e)local e=(10^(e*.05))if(e<o or tostring(e)=="-1.#IND")then e=o end return e end function createVUSlider(e)local e=createSlider(e)e._mulValue=4;e.maxValue=4 e.minValue=0 e.meterType=1 function e:valueToText()return string.format(" %0.2f dB",math.valueToDecivel(self.value))end function e:_drawHorizontalMeter()gfx.set(self:getColor("meter_value"))gfx.setfont(1,self._fontName,self._fontSize)local e=self._meterValueRect gfx.rect(e.x,e.y,e.w,e.h,true)local e=self.w/self._mulValue*(self._mulValue-1)gfx.set(self:getColor("black"))gfx.line(e,self.y,e,self:getY2())self:_drawValueText()end function e:_updateMeterValueRect()self._meterValueRect=self:getRectangle()self._meterValueRect:reduce(2,2);local e=self.w/self._mulValue*(self._mulValue-1)local t=math.valueToDecivel(self.value);if(self.value<=1)then self._meterValueRect.w=self.x+e*self.value local e=math.valueToDecivel(self.minValue);local e=t/e else local a=self.w-e-self.x local o=math.valueToDecivel(self.maxValue);local t=t/o self._meterValueRect.w=self.x+e+(a*t)end self._meterValueRect:_updateXyTable();end function e:_xyToDecibel(a,e)local t=t local e=self.w/self._mulValue*(self._mulValue-1)if(a<e)then local e=(a-self.x)/e t=math.valueToDecivel(e)else local o=self.w/self._mulValue local e=((a-self.x-e)/o)+1 t=math.valueToDecivel(e)end return t end function e:_xyToValue(t,a)local e=0;local t=self:_xyToDecibel(t,a)e=math.decivelToValue(t)return e;end return e end function createSimpleVCA(t,e,o,n,h)local e=createComponent(t,e,o,n,h)e._animTime=0;e.sl_Vol=nil e.sl_Pan=nil function e:onResized()local e=createRectangle()e.x=self.x e.y=self.y e.w=self.w e.h=self.h/2 self.sl_Vol:setBoundsFromRect(e)e.y=e:getY2()self.sl_Pan:setBoundsFromRect(e)local e=i local t=s self.sl_Vol:reduce_2(e,e,t,0)self.sl_Pan:reduce_2(e,e,t,t)end function e:onDraw(e)self:_syncSliderValue()end function e:_init()self:_createSlider();end function e:_createSlider()self.sl_Vol=createVUSlider("Vol")self.sl_Pan=createSlider("Pan")self.sl_Vol:setMeterType(1)self.sl_Pan:setMeterType(2)self:addChildComponent(self.sl_Vol)self:addChildComponent(self.sl_Pan)self.sl_Vol:addOnValueChangeFunction(function(t)local e=reaper.GetSelectedTrack(a,0);if(e~=nil)then reaper.CSurf_OnVolumeChange(e,t:getValue(),false)reaper.UpdateArrange();end end)self.sl_Pan:addOnValueChangeFunction(function(t)local e=reaper.GetSelectedTrack(a,0);if(e~=nil)then local t=t:getValue()*2-1 reaper.CSurf_OnPanChange(e,t,false)reaper.UpdateArrange();end end)self.sl_Pan.valueToText=function()local t=self.sl_Pan:getValue()*2-1;local e=""if(t==0)then e="  center"elseif(t>0)then e=string.format("  R%3.0f%%",t*100)else e=string.format("  L%3.0f%%",-t*100)end return e end end function e:_syncSliderValue()local e=reaper.GetSelectedTrack(a,0);if(e~=nil)then local a,t,e=reaper.GetTrackUIVolPan(e)self.sl_Pan:setValue(e/2+.5,false)self.sl_Vol:setValue(t,false)end end function e:_checkAnimTime(t,a)self._animTime=self._animTime+(t/a);if(self._animTime>1)then self._animTime=0;end if(self._animTime<0)then self._animTime=0;end end e:_init()return e;end local function a()local e=createApp("SImple VCA",500,200);local t=createSimpleVCA("panel");e:addChildComponent(t);if(n)then e:toggleDock()end e:runLoop();end if(_INCLUDE_MODE_~=true)then a()end local p=60 local v=60 local f=1 local y=1 local w=5 local o=1 local m=false local c=false local u=false local i=5 local n=5 local r=5 local s=1 local t={"","bypass","wet","volume","master","master level","makeup","make up","gain","output","output gain","level","program","preset"}math.randomseed(reaper.time_precise()*os.time()/1e3);local a="kawa_MAIN_RANDMIZE"local h="lastFxParameter"if(package.config:sub(1,1)=="\\")then else end local d=0 local function l()local e={};e._check=nil e.randomWidth=.6;e.exclusiveNames=deepcopy(t)e.matchedParameterName={}e.lastTrackID=nil e.lastFxID=nil e.lastFxParamID=nil e.targetTrack=nil e.lastFxName=""e.lastFxParamName=""e.lastFxParam_value={}function e:setRandomWidth(e)self.randomWidth=e if(self.randomWidth<0)then self.randomWidth=0 end if(self.randomWidth>1)then self.randomWidth=1 end end function e:storeBasePreset()self._check=self:_storeLastFxInfo();if(self._check==true)then self:_storeFxParamValue();self:_saveState()else self.lastFxParam_value={}self:_saveState()end end function e:randomize()self.matchedParameterName={}self._check=self:_storeLastFxInfo();if(self._check==false)then return;end local t=self.randomWidth*o self:_loadState();if(self:_isSameTrackFx()==false)then self._check=self:_storeLastFxInfo();if(self._check==false)then return;end self:_storeFxParamValue();self:_saveState()end for a,e in ipairs(self.lastFxParam_value)do if(self:_isExclusiveParam(e.fxPramName)==false)then local t=e.fxPramValue+(t*math.random())-(t/2);if(t>1)then t=1;end if(t<0)then t=0;end reaper.TrackFX_SetParamNormalized(self.targetTrack,e.trackFxID,e.fxPramID,t)else table.insert(self.matchedParameterName,e.fxPramName);end end end function e:addExclusivParam(t)local e=false;for o,a in ipairs(self.exclusiveNames)do if(a==t)then e=true;break;end end if(e==false)then table.insert(self.exclusiveNames,1,t)end end function e:removeExclusivParam(a)for t,e in ipairs(self.exclusiveNames)do if(e==a)then table.remove(self.exclusiveNames,t)break;end end end function e:_init()self._check=self:_storeLastFxInfo();end function e:_storeLastFxInfo()local e=false;local t=false;local a=false;e,self.lastTrackID,self.lastFxID,self.lastFxParamID=reaper.GetLastTouchedFX();local o=nil if(c==false)then e,self.lastTrackID,o,self.lastFxID=reaper.GetFocusedFX()end self.targetTrack=reaper.GetTrack(d,self.lastTrackID-1);if(e and self.targetTrack~=nil)then t,self.lastFxName=reaper.TrackFX_GetFXName(self.targetTrack,self.lastFxID,"")a,self.lastFxParamName=reaper.TrackFX_GetParamName(self.targetTrack,self.lastFxID,self.lastFxParamID,"")self.lastFxName=string.lower(self.lastFxName)self.lastFxParamName=string.lower(self.lastFxParamName)end local e=(e~=false and t~=false);if(e==false)then self.lastFxName=""self.lastFxParamName=""end return e;end function e:_isExclusiveParam(e)local t=string.lower(e)local e=false;for o,a in ipairs(self.exclusiveNames)do if(t==a)then e=true;break;end end return e end function e:_storeFxParamValue()self.lastFxParam_value={}if(self._check~=true)then return end;local e=reaper.TrackFX_GetNumParams(self.targetTrack,self.lastFxID);for t=0,e-1 do local e,a=reaper.TrackFX_GetParamName(self.targetTrack,self.lastFxID,t,"")if(e==true)then local e={}e.trackID=self.lastTrackID e.trackFxID=self.lastFxID e.fxName=self.lastFxName e.fxPramID=t e.fxPramName=string.lower(a)e.fxPramValue=reaper.TrackFX_GetParamNormalized(self.targetTrack,self.lastFxID,t)table.insert(self.lastFxParam_value,e)end end end function e:_saveState()reaper.SetExtState(a,h,table.toString(self.lastFxParam_value),false);end function e:_loadState()local e=reaper.GetExtState(a,h);if(e~="")then self.lastFxParam_value=table.fromString(e)else self.lastFxParam_value={};end end function e:_isSameTrackFx()local t=false for a,e in ipairs(self.lastFxParam_value)do if(self.lastTrackID==e.trackID and self.lastFxID==e.trackFxID and self.lastFxName==e.fxName)then t=true break;end end return t;end e:_init()return e;end local function d(t,e)local e=createTextPanel(e)e._fxRandomiza_P=t e._lastFxParamName_=""e:setColor("text",{0,0,0,1})e:setColor("background",{1,1,1,1})e:setColor("lockedparameter",{1,0,0,1})e:setColor("matchedparameter",{0,.5,1,1})function e:onDraw(e)local s=self._fxRandomiza_P.matchedParameterName if(self._lastFxParamName_~=self._fxRandomiza_P.lastFxParamName)then self._lastFxParamName_=self._fxRandomiza_P.lastFxParamName self:tryTextShown(self._lastFxParamName_)end gfx.set(self:getColor("background"))gfx.rect(self.x,self.y,self.w,self.h,true)gfx.setfont(1,self._fontName,self._fontSize)gfx.set(self:getColor("text"))local a=i local t=n local e="LOCKED PARAMETER NAME"local o="---------------------"gfx.x=self.x+a gfx.y=self.y+t gfx.printf(e.."\n"..o.."\n")local o=0+a/2 local i=gfx.y+t*2 for e=self.offsetY+1,#self.drawTexts do local o=o+a local a=i+gfx.texth*(e-self.offsetY-1)+t if(a>self.y+self.h-t*2)then break;end gfx.set(self:getColor("text"))if(m)then for a,t in ipairs(s)do if(t==self.drawTexts[e])then gfx.set(self:getColor("matchedparameter"))end end end local t=self._fxRandomiza_P.lastFxParamName or""if(string.lower(self.drawTexts[e])==string.lower(t))then gfx.set(self:getColor("lockedparameter"))end local t=tostring(e)..":";gfx.x=o gfx.y=a gfx.drawstr(t..self.drawTexts[e])end end return e;end local function h(e)local e=createSlider(e)function e:valueToText()return string.format("%3.0f%%(+-%2.0f%%)",self.value*o*100,self.value*o*100/2)end return e end function createFxRandomizaComponent(e)local e=createComponent(e)e.fxRandomiza=l()e.bt_Random=nil e.bt_addExclusivParam=nil e.bt_removeExclusivParam=nil e.bt_storeBasePreset=nil e.sl_randWidth=nil e.text_exclusiveList=nil e._lastFx_Name=""e._lastTrackID=nil e._lastFxID=nil e._hueOffset=0;function e:onResized()local t=4 local a=90 local e=createRectangle();e.x=self.x e.y=self.y+45 e.w=(self.w/t)e.h=a/2 self.bt_Random:setBoundsFromRect(e)e.x=e.x+e.w self.bt_storeBasePreset:setBoundsFromRect(e)e.x=e.x+e.w self.bt_addExclusivParam:setBoundsFromRect(e)e.x=e.x+e.w self.bt_removeExclusivParam:setBoundsFromRect(e)local t=createRectangle();t.x=self.x t.y=e:getY2()t.w=self.w t.h=a/2 self.sl_randWidth:setBoundsFromRect(t)local e=createRectangle();e.x=self.x e.y=t:getY2()e.w=self.w e.h=self:getY2()-t:getY2()self.text_exclusiveList:setBoundsFromRect(e)local e=n local t=i self.bt_Random:reduce_2(e,0,t,0)self.bt_storeBasePreset:reduce_2(e,0,t,0)self.bt_addExclusivParam:reduce_2(e,0,t,0)self.bt_removeExclusivParam:reduce_2(e,e,t,0)self.sl_randWidth:reduce_2(e,e,t,0)self.text_exclusiveList:reduce(e,t)end function e:onDraw(e)self:_drawBorder()self:_checkLastFx();self:_drawlastTrackFxInfo()end function e:_init()self:_createButton()self:_createSlider()self:_createTextPanel()end function e:_checkLastFx()self.fxRandomiza:_storeLastFxInfo()end function e:_createButton()self.bt_Random=createButton("RANDOM")self.bt_addExclusivParam=createButton("LOCK")self.bt_removeExclusivParam=createButton("UNLOCK")self.bt_storeBasePreset=createButton("SET")self:addChildComponent(self.bt_Random)self:addChildComponent(self.bt_addExclusivParam)self:addChildComponent(self.bt_removeExclusivParam)self:addChildComponent(self.bt_storeBasePreset)self.bt_Random:setColor("background",{1,1,1,.8})self.bt_addExclusivParam:setColor("background",{1,1,1,.8})self.bt_removeExclusivParam:setColor("background",{1,1,1,.8})self.bt_storeBasePreset:setColor("background",{1,1,1,.8})self.bt_Random:setFont("",17)self.bt_addExclusivParam:setFont("",17)self.bt_removeExclusivParam:setFont("",17)self.bt_storeBasePreset:setFont("",17)local e=self;local function t(o)local e=math.floor(360*math.random());local a,t,e=HSVToRGB(e,.65,1)a,t,e=a/255,t/255,e/255 o:setColor("background",{a,t,e,1})o:setColor("background_onMouse",{a,t,e,1})end self.bt_Random:addMouseReleaseFunction(function(a,o)e.fxRandomiza:randomize()t(a)end);self.bt_Random:addMouseWheelFunction(function(a,o)e.fxRandomiza:randomize()t(a)end)self.bt_addExclusivParam:addMouseReleaseFunction(function(o,a)local a=e.fxRandomiza.lastFxParamName e.fxRandomiza:addExclusivParam(a)e.text_exclusiveList:tryTextShown(a)t(o)end);self.bt_removeExclusivParam:addMouseReleaseFunction(function(o,a)local a=e.fxRandomiza.lastFxParamName e.fxRandomiza:removeExclusivParam(a)e.text_exclusiveList:setTextOffsetLine(0)t(o)end);self.bt_storeBasePreset:addMouseReleaseFunction(function(a,o)e.fxRandomiza:storeBasePreset()t(a)end);end function e:_createSlider()self.sl_randWidth=h("Random Width")self.sl_randWidth:setColor("background",{1,1,1,.8})self:addChildComponent(self.sl_randWidth)local e=self;self.sl_randWidth:addOnValueChangeFunction(function(t)e.fxRandomiza:setRandomWidth(t:getValue())end);self.sl_randWidth:setFont("",18)end function e:_createTextPanel()self.text_exclusiveList=d(self.fxRandomiza,"list")self:addChildComponent(self.text_exclusiveList)self.text_exclusiveList:setColor("background",{1,1,1,.8})self.text_exclusiveList:setDrawTexts(self.fxRandomiza.exclusiveNames)self.text_exclusiveList:setFont("",16.5)end function e:_drawlastTrackFxInfo()local t=tostring(self.fxRandomiza.lastTrackID)local o=tostring(self.fxRandomiza.lastFxID)local e=tostring(self.fxRandomiza.lastFxName)local a=tostring(self.fxRandomiza.lastFxParamName)local t=t..":"..o..":"..e;local e="Parameter:"..a;gfx.setfont(1,self._fontName,15)gfx.set(self:getColor("white"))gfx.mode=1 gfx.x=self.x+10 gfx.y=self.y+12 gfx.drawstr(t)gfx.y=gfx.y+gfx.texth gfx.x=self.x+10 gfx.drawstr(e)gfx.mode=0 end function e:_drawBorder()if(self._lastFx_Name~=self.fxRandomiza.lastFxName or self._lastTrackID~=self.fxRandomiza.lastTrackID or self._lastFxID~=self.fxRandomiza.lastFxID)then self._hueOffset=math.random()*360 self._lastFx_Name=self.fxRandomiza.lastFxName self._lastTrackID=self.fxRandomiza.lastTrackID self._lastFxID=self.fxRandomiza.lastFxID end local a=w;local t=self.w/a local o=1/a;for e=1,a do local a,o,i=HSVToRGB(p+self._hueOffset+v*(e/a),y,f)gfx.set(a/255,o/255,i/255,1*self._componentAlpha)gfx.rect(t*(e-1)-1,self.y,t+5,r,true)gfx.rect(t*(e-1)-1,self:getY2()-s,t+5,s,true)end end e:_init()return e;end local function t()local e=createApp("Fx Randomiza",400,280);local t=createFxRandomizaComponent("random")e:addChildComponent(t)if(u)then e:toggleDock()end e:runLoop();end if(_INCLUDE_MODE_~=true)then t()end local r=false local h=5 local s=5 if(package.config:sub(1,1)=="\\")then else end function createRangeInfoComp(n,i,a,o,e,t)local e=createComponent(i,a,o,e,t)e._animTime=0;e._drawStrings={}e._isLoopRange=false function e:setLoopRangeMode(e)self._isLoopRange=e end function e:onResized()end function e:onDraw(e)self:_drawTimeSelectionInfo()end function e:_init()end function e:_secTimeToStr(e)local t=math.floor(e/60)local a=math.floor(e%60)local e=e-math.floor(e)e=math.floor(e*100)local t=tostring(t)local a=tostring(a)local e=tostring(e)if(#t<2)then t="0"..t;end if(#a<2)then a="0"..a;end if(#e<2)then e="0"..e;end local e=string.format("%s:%s:%s",t,a,e);return e;end function e:_secTimeToProjQnStr(a,e)local t=e or 0 local i,a,o,e,i=reaper.TimeMap2_timeToBeats(0,a)local t=string.format("%3.0f",a+t)local a=e%o local a=string.format("%1.2f",a)local e=tostring(e)return t..":"..a end function e:_drawTimeSelectionInfo()local a,t=reaper.GetSet_LoopTimeRange2(0,false,self._isLoopRange,0,0,false)if(a==t)then a=0 t=0 end local i="start: "..self:_secTimeToStr(a)local n="end  : "..self:_secTimeToStr(t)local o="range: "..self:_secTimeToStr(t-a)i=i.." beat:"..self:_secTimeToProjQnStr(a,1)n=n.." beat:"..self:_secTimeToProjQnStr(t,1)o=o.." beat:"..self:_secTimeToProjQnStr(t-a)self._drawStrings={}table.insert(self._drawStrings,i);table.insert(self._drawStrings,n);table.insert(self._drawStrings,o);local t=math.max(#i,#n,#o)local a=self.w/t*1.9 local t=self.h/#self._drawStrings local t=math.max(math.min(a,t),5);self:setFont("",t)gfx.set(1,1,1,1*self._componentAlpha)local a=self.x+h local t=self.y+s for e,o in ipairs(self._drawStrings)do gfx.x=a gfx.y=t+gfx.texth*(e-1)gfx.drawstr(o)end end e:_init()return e;end local function a()local e=createApp("Loop Selection Info ",450,100);local t=createRangeInfoComp("panel");t:setLoopRangeMode(true)e:addChildComponent(t);if(r)then e:toggleDock()end e:runLoop();end if(_INCLUDE_MODE_~=true)then a()end local d=true local o=false local u=180 local r=-60 local l=1 local h=7 local n="Courier New bold"DEFINE_WEEKDAYNAME={"Sun","Mon","Tue","Wed","Thu","Fri","Sat",}if(package.config:sub(1,1)=="\\")then else end function createClockComponent(t,e,a,s,i)local e=createComponent(t,e,a,s,i)e._animTime=0;function e:onResized()end function e:onDraw(e)if(o)then self:_drawBackground()end self:_drwaClock()self:_checkAnimTime(e,5)end function e:_init()end function e:_drawBackground()local e=h;local a=self.w/e local t=1/e;for t=1,e do local i,o,e=HSVToRGB(u+r*(t/e),1,l)gfx.set(i/255,o/255,e/255,1*self._componentAlpha)gfx.rect(a*(t-1)-1,self.y,a+1,self.h,true)end end function e:_checkAnimTime(t,e)self._animTime=self._animTime+(t/e);if(self._animTime>1)then self._animTime=0;end if(self._animTime<0)then self._animTime=0;end end function e:_drwaClock()local t=DEFINE_WEEKDAYNAME[tonumber(os.date("%w"))+1]local t=os.date("%Y/%m/%d("..t..") %H:%M:%S")local a=#t+1 local i=self.w/a*1.8 local i=math.max(math.min(i,self.h),20);gfx.setfont(1,n,i)if(o==false)then gfx.set(self:getColor("white"))else gfx.set(self:getColor("black"))end local o=(a)*gfx.texth/2 local a=self:getCenterPoint()gfx.y=a.y-gfx.texth/2 gfx.x=a.x-o/2-gfx.texth/4 gfx.drawstr(t)end e:_init()return e;end local function t()local e=createApp("Clock",450,100);local t=createClockComponent("panel");e:addChildComponent(t);if(d)then e:toggleDock()end e:runLoop()end if(_INCLUDE_MODE_~=true)then t()end local h=0 local s=60 local n=1 if(package.config:sub(1,1)=="\\")then else end function createTestComponent(i,o,e,t,a,r)local e=createComponent(o,e,t,a,r)e._mainApp_p=i e.buttonTable={}e.buttonNum=8 e._animTime=0;function e:onResized()self:_changeButtonSize()end function e:onDraw(e)self:_drawBackground()self:_drawCircle()self:_drawInfo(e)self:_checkAnimTime(e,3)end function e:_init()self:_createButtons();end function e:_changeButtonSize()local t=self.w/self.buttonNum local o=self.h/4 for a,e in ipairs(self.buttonTable)do local i=tostring(a)local a=self.x+t*(a-1)local i=self.y+(self.h/4)*3 e:setBounds(a,i,t,o)e:reduce(3,5)end end function e:_createButtons()local e=gfx.w/self.buttonNum local a=gfx.h/4 for t=1,self.buttonNum do local o=tostring(t-1)local t=self.x+e*(t-1)local i=self.y+(gfx.h/4)*3 local t=createButton(o,t,i,e,a)t:reduce(3,5)self:addChildComponent(t)t:addMouseReleaseFunction(function(e,t)if(gfx.dock(-1)>0)then gfx.dock(0)else if(tonumber(e.name)==0)then gfx.dock(1)end if(tonumber(e.name)==1)then gfx.dock(257)end if(tonumber(e.name)==2)then gfx.dock(513)end if(tonumber(e.name)==3)then gfx.dock(769)end if(tonumber(e.name)==4)then gfx.dock(1025)end if(tonumber(e.name)==5)then gfx.dock(1281)end if(tonumber(e.name)==6)then gfx.dock(1537)end if(tonumber(e.name)==7)then gfx.dock(3841)end end end);table.insert(self.buttonTable,t)end end function e:_deleteButtons()for t,e in ipairs(self.buttonTable)do self:removeChildComponent(e)end self.buttonTable={};end function e:_drawBackground()local e=15;local t=math.ceil(self.w/e)local a=1/e;for a=1,e do local i,e,o=HSVToRGB(h+s*(a/e),1,n)gfx.set(i/255,e/255,o/255,1*self._componentAlpha)gfx.rect(self.x+t*(a-1)-1,self.y,t,self.y+self.h,true)end end function e:_drawInfo(e)gfx.set(1,1,1,1*self._componentAlpha)gfx.x=self.x+10 gfx.y=self.y+10 gfx.printf("X: "..tostring(self._mainApp_p._lastMouseX))gfx.x=self.x+10 gfx.y=gfx.y+gfx.texth gfx.printf("Y: "..tostring(self._mainApp_p._lastMouseY))gfx.y=gfx.y+gfx.texth gfx.x=self.x+10 gfx.printf("dt: "..string.format("%1.3f",e))gfx.y=gfx.y+gfx.texth gfx.x=self.x+10 gfx.printf("animTime: "..string.format("%1.3f",self._animTime))gfx.y=gfx.y+gfx.texth gfx.x=self.x+10 gfx.printf("wheel: "..tostring(self._mainApp_p.mouseWheelDt))end function e:_drawCircle()local e=10 gfx.set(1,1,1,.5*self._componentAlpha);local n=self.w/e local a=3 local s=360/e local o=(self.h/4)*3/2-30 local i=(self.h/4)*3/2 for t=1,e do local n=self.x+n*(t-1);local e=math.rad(360*self._animTime)e=e+math.rad(s*(t-1))local t=self.y+i+((o)*(math.sin(e)))gfx.circle(n,t,a,true,false)e=e-math.rad(180)t=self.y+i+(o*(math.sin(e)))gfx.circle(n,t,a,true,false)end end function e:_checkAnimTime(a,t)self._animTime=self._animTime+(a/t);if(self._animTime>1)then self._animTime=0;end if(self._animTime<0)then self._animTime=0;end end e:_init()return e;end local function a()local e=createApp("test",600,300);local t=createTestComponent(e,"panel");e:addChildComponent(t);e:runLoop()end if(_INCLUDE_MODE_~=true)then a()end local c=false local o=true local t=30 local d=-60 local r=1 local h=1 local a=8 local n="Courier New bold"if(package.config:sub(1,1)=="\\")then else end function createParticalComponent(e,u,l,i,s)local e=createComponent(e,u,l,i,s)e._animTime=0;e._particals=createParticleManager();e._isParticleOriginMouse=false;function e:onResized()end function e:toggleParticleOriginMouseMode()self._isParticleOriginMouse=(self._isParticleOriginMouse==false)or false;end function e:onDraw(e)if(o)then self:_drawBackground()end self:_checkAnimTime(e,5)self._particals:updateAndDraw();if(self.isMouseLeftDown)then self._particals:addParticleType1(gfx.mouse_x,gfx.mouse_y,4);end if(self._isParticleOriginMouse)then self._particals:setOriginePoint_A(gfx.mouse_x,gfx.mouse_y);end self:_drawParticalInfo();end function e:onMousePress(e)if(self.isMouseRightDown)then self:toggleParticleOriginMouseMode();a=a+4;if(a>12)then a=4;end;end end function e:onMouseWheel(e)local e=self._particals:getTargetRadiusSize()+e*2;self._particals:setTargetRadiusSize(e);end function e:_init()end function e:_drawBackground()t=t+1;if(t>360)then t=0;end if(t<0)then t=360;end local o=a;local n=a;local a=self.w/o;local i=self.h/n;local e=0;for n=1,n do local s=i*(n-1)-1;for n=1,o do local o,t,e=HSVToRGB(t+d*(n/o)+e,r,h)gfx.set(o/255,t/255,e/255,1*self._componentAlpha)gfx.rect(a*(n-1)-1+self.x,s+self.y,a+1,i+1,true,false)end e=e+10;end end function e:_checkAnimTime(e,t)self._animTime=self._animTime+(e/t);if(self._animTime>1)then self._animTime=0;end if(self._animTime<0)then self._animTime=0;end end function e:_drawTitle()local e="Perticle Anim";local t=#e+1 local a=self.w/t*1.8 local a=math.max(math.min(a,self.h),20);gfx.setfont(1,n,a)if(o==false)then gfx.set(self:getColor("white"))else gfx.set(self:getColor("black"))end local a=(t)*gfx.texth/2 local t=self:getCenterPoint()gfx.y=t.y-gfx.texth/2 gfx.x=t.x-a/2-gfx.texth/4 gfx.drawstr(e)end function e:_drawParticalInfo()local t=self._particals:getActiveParticalNum();local a="partical Num:"..tostring(t);if(o==false)then gfx.set(self:getColor("white"))else gfx.set(self:getColor("black"))end local t=17;gfx.setfont(1,n,t)gfx.y=self.y gfx.x=self.x+10;gfx.drawstr(a);local t=self._particals:getTargetRadiusSize();local t="partical Radius:"..tostring(t);gfx.y=gfx.y+gfx.texth;gfx.x=self.x+10;gfx.drawstr(t);local t=self._isParticleOriginMouse;local t="rotation Type:"..tostring(t);gfx.y=gfx.y+gfx.texth;gfx.x=self.x+10;gfx.drawstr(t);end e:_init()return e;end local function a()local e=createApp("Partical Animation",550,350);local t=createParticalComponent("panel");e:addChildComponent(t);if(c)then e:toggleDock()end e:runLoop()end if(_INCLUDE_MODE_~=true)then a()end if(package.config:sub(1,1)=="\\")then _INCLUDE_MODE_=true else _INCLUDE_MODE_=true end local function n()local o=createApp("test",750,300);local e=createTabComponent("top Tab Component")local t=createTabComponent("meters Tab")t:addTab("peakMeter",createPeakMeter())t:addTab("osilloscope",createOsilloScope())t:addTab("gonioMeter",createGonioMeter())t:changeTab("peakMeter")t:setButtonMargin(3,3,0,3)local a=createTabComponent("range Info Tab")local i=createRangeInfoComp()i:setLoopRangeMode(true)a:addTab("Time Selection",createRangeInfoComp())a:addTab("Loop Range",i)a:changeTab("Time Selection")a:setButtonMargin(3,3,0,2)o:addChildComponent(e);e:addTab("Clock",createClockComponent())e:addTab("Test",createTestComponent(o))e:addTab("Meters",t)e:addTab("Range Info",a)e:addTab("SimpleVCA",createSimpleVCA())e:addTab("FxRandomiza",createFxRandomizaComponent())e:addTab("Partical",createParticalComponent())e:changeTab("SimpleVCA")o:runLoop();end n();
